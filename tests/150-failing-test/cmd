$SHELL ${2?} $PWD/test
ex=$?

cleanup()
{
  rm -f "$PWD/test/exit.actual"
  rm -f "$PWD/test/err.actual"
  rm -f "$PWD/test/out.actual"
  rm -f "$PWD/test/exit.diff"
  rm -f "$PWD/test/err.diff"
  rm -f "$PWD/test/out.diff"
}
trap cleanup EXIT

assert_file()
{
  test -f "${1:?}" || exit 125
}
assert_same()
{
  diff -u "${1:?}" "${2:?}" || exit 125
}

assert_file "$PWD/test/exit.diff"
assert_file "$PWD/test/err.diff"
assert_file "$PWD/test/out.diff"
assert_same "$PWD/expected/exit.diff" "$PWD/test/exit.diff"
assert_same "$PWD/expected/err.diff" "$PWD/test/err.diff"
assert_same "$PWD/expected/out.diff" "$PWD/test/out.diff"

exit $ex
